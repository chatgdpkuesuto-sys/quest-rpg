<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machadun Dashboard (OBS Overlay)</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- ðŸŒŸ NEW: é­šçœ¼ãƒ¬ãƒ³ã‚ºï¼ˆçƒé¢ï¼‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å®šç¾© ðŸŒŸ -->
    <svg style="position: fixed; width: 0; height: 0;">
        <filter id="fisheye-filter">
            <feTurbulence type="fractalNoise" baseFrequency="0.01" numOctaves="1" result="noise" />
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="0" xChannelSelector="R" yChannelSelector="G"
                id="fisheye-map" />
            <!-- çƒé¢æ­ªã¿ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«å†ç¾ã™ã‚‹ãŸã‚ã« matrix ã¨ scale ã‚’çµ„ã¿åˆã‚ã›ã‚‹ï¼ˆå¾Œã»ã©JSã§åˆ¶å¾¡ï¼‰ -->
        </filter>
    </svg>

    <!-- èƒŒæ™¯CGç”¨ã‚³ãƒ³ãƒ†ãƒŠ (engine.js ã§ background-image ã‚’å‹•çš„ã«åˆ¶å¾¡) -->
    <div id="bg-container"></div>

    <!-- ç‹‚æ°—ãƒ»ç™ºæƒ…ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="blood-overlay"></div>
    <div id="glitch-overlay"></div>

    <!-- Zundamon Voice Player -->
    <audio id="voice-player" src="outputs/voice.wav" preload="none"></audio>
    <!-- Sound Effects Player -->
    <audio id="se-player" preload="none"></audio>

    <!-- ðŸŒŸ NEW: ä¸‰é€£ãƒ»è“„ç©ã‚²ãƒ¼ã‚¸ï¼ˆä¸‰ã¤ã®ç™ºå±•ï¼‰ ðŸŒŸ -->
    <div id="buildup-container">
        <!-- å—œè™ï¼šå³ã‚¯ãƒªãƒƒã‚¯ -->
        <div class="buildup-bar">
            <div id="fill-lust" class="buildup-fill lust"></div><span class="gauge-label">LUST / CHAOS</span>
        </div>
        <!-- ç®¡ç†ï¼šä¸­ã‚¯ãƒªãƒƒã‚¯ -->
        <div class="buildup-bar">
            <div id="fill-special" class="buildup-fill special"></div><span class="gauge-label">SENSE / OBSERVE</span>
        </div>
        <!-- æ…ˆæ„›ï¼šå·¦ã‚¯ãƒªãƒƒã‚¯ -->
        <div class="buildup-bar">
            <div id="fill-love" class="buildup-fill love"></div><span class="gauge-label">LOVE / CARESS</span>
        </div>
    </div>

    <!-- ðŸŒŸ NEW: ã‚¯ãƒ©ã‚¤ãƒžãƒƒã‚¯ã‚¹ç™ºå‹•ãƒœã‚¿ãƒ³ï¼ˆæ‰‹å‹•ï¼‰ ðŸŒŸ -->
    <button id="climax-trigger" onclick="triggerClimax()">CLIMAX!!</button>

    <!-- ðŸŒŸ NEW: ãƒžãƒ³ã‚¬é¢¨ å¹ãå‡ºã—ã‚³ãƒ³ãƒ†ãƒŠ ðŸŒŸ -->
    <div id="bubble-container"></div>

    <!-- ðŸŒŸ NEW: åˆ†å‰²ã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã®èª­ã¿è¾¼ã¿ ðŸŒŸ -->
    <script src="js/fx.js"></script>
    <script src="js/motion.js"></script>
    <script src="js/interaction.js"></script>

    <script>
        // --- ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç† (å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å…±æœ‰) ---
        window.gauges = { love: 0, lust: 0, special: 0 };
        window.time = 0;
        window.mirrorScale = 1;
        window.pendingClimax = null;
        window.currentOriginX = 50;
        window.currentOriginY = 50;
        window.targetOriginX = 50;
        window.targetOriginY = 50;
        window.zoomBoost = 0;

        // APIé€£æºé–¢æ•°
        async function sendAction(actionName, x = 0, y = 0) {
            console.log(`Action Sent: ${actionName} at (${x}%, ${y}%)`);
            document.body.style.animation = "shake 0.1s";
            setTimeout(() => document.body.style.animation = "none", 100);

            try {
                await fetch(`http://localhost:5000/action?t=${Date.now()}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: actionName, x: x, y: y, time: Date.now() })
                });
            } catch (e) {
                console.error("Failed to send action:", e);
            }
        }

        // åˆæœŸåŒ–å‡¦ç†
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof initEngine === "function") initEngine();
            updateVisuals();
            kineticAnimationLoop();
            startDecayLoop();
            setupInteraction();
        });
    </script>

    <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼ -->
    <script src="status.js"></script>
    <!-- ã‚¨ãƒ³ã‚¸ãƒ³ãƒ­ã‚¸ãƒƒã‚¯èª­è¾¼ -->
    <script src="engine.js"></script>
</body>

</html>