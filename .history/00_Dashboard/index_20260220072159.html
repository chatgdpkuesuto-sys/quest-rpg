<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machadun Dashboard (OBS Overlay)</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- èƒŒæ™¯CGç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="bg-container">
        <!-- åˆæœŸç”»åƒã€‚ç”Ÿæˆå¾Œã¯æœ€æ–°ç”»åƒã«ç½®ãæ›ã‚ã‚Šã¾ã™ -->
        <img id="bg-image" src="outputs/latest.png" alt="Current CG"
            onerror="this.src=''; this.style.backgroundColor='#0a0000';">
    </div>

    <!-- ç‹‚æ°—ãƒ»ç™ºæƒ…ã‚¨ãƒ•ã‚§ã‚¯ãƒˆç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="blood-overlay"></div>
    <div id="glitch-overlay"></div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆç”»é¢ä¸‹éƒ¨ãªã©ã«é…ç½®ï¼‰ -->
    <div id="status-container">
        <div class="status-box">
            <div class="status-label">Arousal (ç™ºæƒ…åº¦)</div>
            <div class="progress-bar">
                <div id="arousal-fill" class="progress-fill arousal"></div>
            </div>
            <div id="arousal-value" class="status-value">0%</div>
        </div>

        <div class="status-box">
            <div class="status-label">Despair (çµ¶æœ›åº¦)</div>
            <div class="progress-bar">
                <div id="despair-fill" class="progress-fill despair"></div>
            </div>
            <div id="despair-value" class="status-value">0%</div>
        </div>
    </div>

    <!-- BGMç­‰åˆ¶å¾¡ç”¨ã®åˆæœŸåŒ–ãƒœã‚¿ãƒ³ (ãƒ–ãƒ©ã‚¦ã‚¶ã®è‡ªå‹•å†ç”Ÿãƒãƒªã‚·ãƒ¼å¯¾ç­–ç”¨) -->
    <div id="init-audio" onclick="initEngine()">[CLICK TO IGNITION]</div>

    <!-- Zundamon Voice Player -->
    <audio id="voice-player" src="outputs/voice.wav" preload="none"></audio>

    <!-- ğŸŒŸ NEW: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰ãƒœãƒƒã‚¯ã‚¹ ğŸŒŸ -->
    <div id="dialogue-container">
        <div id="dialogue-text">ã“ã“ã«AIï¼ˆã‚Šã‚Šã™ï¼‰ã‹ã‚‰ã®å®˜èƒ½ãƒ†ã‚­ã‚¹ãƒˆã‚„æ‚²é³´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™â€¦â€¦ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>
    </div>

    <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ‘ãƒãƒ« (Neural Bridge) -->
    <div id="action-panel">
        <button class="action-btn" onclick="sendAction('æœã‚’è„±ãŒã›ã‚‹')">æœã‚’è„±ãŒã›ã‚‹</button>
        <button class="action-btn" onclick="sendAction('åªšè–¬ã‚’ä½¿ã†')">åªšè–¬ã‚’ä½¿ã†</button>
        <button class="action-btn" onclick="sendAction('åŠ›å¼·ãæŠ±ãã—ã‚ã‚‹')">åŠ›å¼·ãæŠ±ãã—ã‚ã‚‹</button>
        <button class="action-btn" onclick="sendAction('æ”¾ç½®ã—ã¦è¦‹å®ˆã‚‹')">æ”¾ç½®ã—ã¦è¦‹å®ˆã‚‹</button>
    </div>

    <!-- Neural Bridgeé€ä¿¡ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        async function sendAction(actionName) {
            console.log("Action Sent:", actionName);

            // è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ï¼‰
            document.body.style.animation = "shake 0.2s";
            setTimeout(() => document.body.style.animation = "none", 200);

            try {
                // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ã¤ã‘ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–ã™ã‚‹
                await fetch(`http://localhost:5000/action?t=${Date.now()}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify({ action: actionName, time: Date.now() })
                });
            } catch (e) {
                console.error("Failed to send action:", e);
            }
        }
    </script>

    <!-- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­è¾¼ -->
    <script src="status.js"></script>
    <!-- ã‚¨ãƒ³ã‚¸ãƒ³ãƒ­ã‚¸ãƒƒã‚¯èª­è¾¼ -->
    <script src="engine.js"></script>
</body>

</html>