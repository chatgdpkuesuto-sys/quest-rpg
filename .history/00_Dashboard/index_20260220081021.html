<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machadun Dashboard (OBS Overlay)</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- ËÉåÊôØCGÁî®„Ç≥„É≥„ÉÜ„Éä (engine.js „Åß background-image „ÇíÂãïÁöÑ„Å´Âà∂Âæ°) -->
    <div id="bg-container"></div>

    <!-- ÁãÇÊ∞ó„ÉªÁô∫ÊÉÖ„Ç®„Éï„Çß„ÇØ„ÉàÁî®„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
    <div id="blood-overlay"></div>
    <div id="glitch-overlay"></div>

    <!-- Zundamon Voice Player -->
    <audio id="voice-player" src="outputs/voice.wav" preload="none"></audio>
    <!-- Sound Effects Player -->
    <audio id="se-player" preload="none"></audio>

    <!-- üåü NEW: ‰∏âÈÄ£„ÉªËìÑÁ©ç„Ç≤„Éº„Ç∏ÔºàÊ∫ú„Åæ„Å£„Åü„ÇâAI„ÅåÂãï„ÅèÔºâ üåü -->
    <div id="buildup-container">
        <div class="buildup-bar">
            <div id="fill-love" class="buildup-fill love"></div>
        </div>
        <div class="buildup-bar">
            <div id="fill-lust" class="buildup-fill lust"></div>
        </div>
        <div class="buildup-bar">
            <div id="fill-special" class="buildup-fill special"></div>
        </div>
    </div>

    <!-- üåü NEW: „Éû„É≥„Ç¨È¢® Âêπ„ÅçÂá∫„Åó„Ç≥„É≥„ÉÜ„Éä üåü -->
    <div id="bubble-container"></div>

    <script>
        async function sendAction(actionName, x = 0, y = 0) {
            console.log(`Action Sent: ${actionName} at (${x}%, ${y}%)`);

            // Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÔºà„ÇØ„É™„ÉÉ„ÇØÊôÇÔºâ
            document.body.style.animation = "shake 0.1s";
            setTimeout(() => document.body.style.animation = "none", 100);

            try {
                // URL„Éë„É©„É°„Éº„Çø„Å´„Çø„Ç§„É†„Çπ„Çø„É≥„Éó„Çí„Å§„Åë„Å¶„Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÂÆåÂÖ®„Å´ÁÑ°ÂäπÂåñ„Åô„Çã
                await fetch(`http://localhost:5000/action?t=${Date.now()}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache'
                    },
                    body: JSON.stringify({
                        action: actionName,
                        x: x,
                        y: y,
                        time: Date.now()
                    })
                });
            } catch (e) {
                console.error("Failed to send action:", e);
            }
        }

        // üåü NEW: „ÇØ„É™„ÉÉ„ÇØ„Ç®„Éï„Çß„ÇØ„ÉàÔºàË¶ñË¶öÁöÑ„ÇÆ„Éü„ÉÉ„ÇØÔºâ
        function createClickEffect(x, y, type = 'heart') {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = x + '%';
            effect.style.top = y + '%';

            // „Çø„Ç§„Éó„Å´„Çà„Å£„Å¶„Ç¢„Ç§„Ç≥„É≥„ÇíÂ§â„Åà„Çã
            if (type === 'heart') effect.innerHTML = '‚ù§Ô∏è';
            else if (type === 'blue-sparkle') effect.innerHTML = '‚ú®';
            else effect.innerHTML = 'üî•';

            document.body.appendChild(effect);

            // ÂäπÊûúÈü≥„ÅÆÂÜçÁîüÔºà„ÅÇ„ÇãÂ†¥ÂêàÔºâ
            const se = document.getElementById('se-player');
            se.src = 'sounds/hit.mp3';
            se.play().catch(e => console.log("SE Play blocked"));

            setTimeout(() => effect.remove(), 800);
        }

        // üåü NEW: „Éï„É´„Çπ„ÇØ„É™„Éº„É≥„Éª„Éû„Ç¶„Çπ„ÇØ„É™„ÉÉ„ÇØÂà∂Âæ° (Â∫ßÊ®ôÂèñÂæóÁâà) üåü
        document.addEventListener('contextmenu', event => event.preventDefault());

        // üåü NEW: ËìÑÁ©ç„Ç≤„Éº„Ç∏„ÅÆÁä∂ÊÖãÁÆ°ÁêÜ
        let buildupGauge = 0;

        document.addEventListener('mousedown', (event) => {
            if (event.target.id === 'init-audio') return;

            const xPercent = Math.round((event.clientX / window.innerWidth) * 100);
            const yPercent = Math.round((event.clientY / window.innerHeight) * 100);

            // 1. „Ç≤„Éº„Ç∏„ÅÆËìÑÁ©ç (+10% per click)
            buildupGauge += 10;
            if (buildupGauge > 100) buildupGauge = 100;

            // 2. „Ç≤„Éº„Ç∏„ÅÆË¶ñË¶öÁöÑÊõ¥Êñ∞
            document.getElementById('buildup-fill').style.width = buildupGauge + '%';

            // 3. „ÇØ„É™„ÉÉ„ÇØ„ÅÆÁ®ÆÈ°û„Å´Âøú„Åò„Åü„Ç®„Éï„Çß„ÇØ„Éà„Å®Á´ã„Å°Áµµ„ÅÆÂàá„ÇäÊõø„Åà
            let clickType = 'heart';
            let actionIntent = "Â∑¶„ÇØ„É™„ÉÉ„ÇØÔºàËÇØÂÆöÔºèÊÑõÊí´Ôºâ";

            if (event.button === 2) {
                clickType = 'fire';
                actionIntent = "Âè≥„ÇØ„É™„ÉÉ„ÇØÔºàÂóúËôêÔºè„Éè„Éó„Éã„É≥„Ç∞Ôºâ";
            } else if (event.button === 1) {
                clickType = 'blue-sparkle';
                actionIntent = "„Éõ„Ç§„Éº„É´„ÇØ„É™„ÉÉ„ÇØÔºàÁâπÊÆäË°åÂãïÔºèË¶≥ÂØüÔºâ";
            }

            createClickEffect(xPercent, yPercent, clickType);
            if (typeof cycleVariant === "function") cycleVariant();

            // 4. „Ç≤„Éº„Ç∏„Åå100%„Å´„Å™„Å£„Åü„ÇâAI„Å´ÈÄÅ‰ø°ÔºÅ
            if (buildupGauge >= 100) {
                console.log("üî• GAUGE FULL! TRIGGERING AI ACTION üî•");

                // „ÉâÊ¥æÊâã„Å™„Ç®„Éï„Çß„ÇØ„Éà
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => createClickEffect(50 + (Math.random() - 0.5) * 20, 50 + (Math.random() - 0.5) * 20, 'blue-sparkle'), i * 50);
                }

                sendAction(actionIntent + " [„Ç≤„Éº„Ç∏MAXÁô∫Âãï]", xPercent, yPercent);

                // „Ç≤„Éº„Ç∏„ÅÆ„É™„Çª„ÉÉ„Éà
                setTimeout(() => {
                    buildupGauge = 0;
                    document.getElementById('buildup-fill').style.width = '0%';
                }, 500);
            }
        });
    </script>

    <!-- Ë®≠ÂÆö„Éï„Ç°„Ç§„É´Ë™≠Ëæº -->
    <script src="status.js"></script>
    <!-- „Ç®„É≥„Ç∏„É≥„É≠„Ç∏„ÉÉ„ÇØË™≠Ëæº -->
    <script src="engine.js"></script>
</body>

</html>